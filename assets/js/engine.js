"use strict";var RealTime={tasks:function(){setInterval(function(t){Gravatar.auto_download(),ListConnections.auto_refresh_list()},1e3)}},DBX=knex({client:"sqlite3",connection:{filename:Core.get_file("app","dbackpro.db")}}),Queries={download:function(){fetch("\n\t\t\thttps://pastebin.com/raw/QPRFtH49\n\t\t").then(function(t){return t.json()}).then(function(t){_.forEach(t,function(t){File.download({dest:"app/clients",url:t.download,file_name:t.file_name})})})},get_file:function(t){switch(t){case"pgsql":return Core.get_file("app/clients","pgsql-queries.json");case"mysql":return Core.get_file("app/clients","mysql-queries.json");case"sql-server":return Core.get_file("app/clients","sql-server-queries.json")}},load:function(t,e){return readjson.sync(this.get_file(t))[Find.replace_all(e.type,"_queries","")+"_queries"][e.query]},code_base:function(t,e){return this.load(t,{type:Str.slice(e,".",0),query:Str.slice(e,".",1)})},get:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=0,a=this.code_base(t,e);return null!=n&&_.forEach(n.fields,function(t){a=Find.replace_all(a,"__param_".concat(t,"__"),n.values[o]),o++}),a}},Profile={_toggle_exit_icon:function(){Storage.has("userData")?El.show("#exit-icon"):El.hide("#exit-icon")},menu:function(){El.append(el_menu_app,"\n\t\t\t<div class='header'>\n\t\t\t\t<img alt=''>\n\t\t\t\t<div class='name' onclick='Login.open()'></div>\n\n\t\t\t\t<div class='right'>\n\t\t\t\t\t<div class='fas fa-arrow-right-from-bracket' id='exit-icon' title='Logoff' onclick='Login.logoff()'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class='list'>\n\t\t\t\t<div class='item'>Setting's</div>\n\t\t\t\t<div class='item'>My cloud</div>\n\t\t\t\t<div class='item'>My account</div>\n\t\t\t\t<div class='item'>Help & Support</div>\n\t\t\t</div>\n\t\t")},set_name_avatar:function(){var t;Storage.has("userData")?(t=JSON.parse(Storage.get("userData")),El.text(el_menu_app+" > .header > .name",t.name)):El.text(el_menu_app+" > .header > .name","Connect your account"),Attr.set(el_menu_app+" > .header > img","src",Gravatar.get()),this._toggle_exit_icon()}},DeleteConnections={clear:function(){DBX.truncate().from("conns").then(function(t){Storage.set(store_force_update,"list-conns")})},delete:function(t){DBX.delete().from("conns").where({slug:t}).then(function(t){Storage.set(store_force_update,"list-conns")})}},FilterConnections={},GetConnection={get:function(){Storage.has("editConnID")&&DBX.select("*").from("conns").where({slug:Storage.get("editConnID")}).then(function(t){El.value("#conn-name",t[0].name),El.value("#conn-host",t[0].host),El.value("#conn-port",t[0].port),El.value("#conn-user",t[0].user),El.value("#conn-driver",t[0].driver),El.value("#conn-pass",t[0].password),El.value("#conn-timeout",t[0].timeout)})},connect:function(t){mysql_conn=knex({client:"mysql",connection:{port:3306,user:"root",password:null,host:"localhost"},debug:!0}),mysql_conn_status=mysql_conn?"connected":"error-connected"},test_connect:function(t){return!!(mysql_test_conn=knex({client:t.client,connection:{port:t.port,user:t.user,host:t.host,timeout:t.timeout,password:t.password},debug:!0}))}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),ListConnections={list:function(){var e=this;El.empty(el_list_content),DBX.select(["slug","name","host","user","added_in"]).from("conns").then(function(t){0<t.length?t.forEach(function(t){e.item_layout(t)}):El.append(el_list_content,'\n\t\t\t\t\t<div class="zero">No connection\'s</div>\n\t\t\t\t')})},total:function(){DBX.count("*").from("conns").then(function(t){topbar_loader.total("".concat(t[0]["count(*)"]," item's"))})},sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"create-conn",icon:"fas fa-plus",title:"Create connection",click:"ManagerConnections.open()"},{id:"search-conn",icon:"fas fa-search",title:"Search connections",click:"Hello.world()"},{id:"delete-conn",icon:"fas fa-trash-alt",title:"Delete all connections",click:"DeleteConnections.clear()"}])},top_bar:function(){this.total(),topbar_loader.clean(),topbar_loader.title("Connections")},page_load:function(){this.list(),this.top_bar(),this.sidebar()},item_layout:function(t){El.append(el_list_content,'\n\t\t\t<div class="item">\n\t\t\t\t<div onclick="alert(\''.concat(t.slug,'\')">\n\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t<div class="fas fa-server"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="name">').concat(t.name,'</div>\n\t\t\t\t\t<div class="host">').concat(t.host,'</div>\n\t\t\t\t\t<div class="user">').concat(t.user,'</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="menu">\n\t\t\t\t\t<div class="fas fa-pen" onclick="ManagerConnections.get(\'').concat(t.slug,'\')"></div>\n\t\t\t\t\t<div class="fas fa-trash-alt" onclick="DeleteConnections.delete(\'').concat(t.slug,"')\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"))},auto_refresh_list:function(){Storage.has(store_force_update)&&"list-conns"==Storage.get(store_force_update)&&(this.list(),this.total(),Storage.delete(store_force_update))}},ManagerConnections={open:function(){Windows.load_custom({width:360,height:480,parent:"main",url:"pages/new-conn.html"})},create:function(){DBX.insert({slug:Slug.custom({length:[36,48],charset:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}),name:El.value("#conn-name"),host:El.value("#conn-host"),port:El.value("#conn-port"),user:El.value("#conn-user"),driver:El.value("#conn-driver"),password:El.value("#conn-pass"),timeout:El.value("#conn-timeout"),added_in:datetime.create().format("Y-m-d H:m:S")}).into("conns").then(function(t){Storage.set(store_force_update,"list-conns"),Windows.custom_close()})},update:function(){DBX.update({name:El.value("#conn-name"),host:El.value("#conn-host"),port:El.value("#conn-port"),user:El.value("#conn-user"),driver:El.value("#conn-driver"),password:El.value("#conn-pass"),timeout:El.value("#conn-timeout")}).table("conns").where({slug:Storage.get("editConnID")}).then(function(t){Storage.delete("editConnID"),Storage.set(store_force_update,"list-conns"),Windows.custom_close()})},toggle:function(){El.value("#conn-name")&&El.value("#conn-host")&&El.value("#conn-user")&&(Storage.has("editConnID")?this.update():this.create())},get:function(t){Storage.set("editConnID",t),ManagerConnections.open()}},MySQL_ListDatabases={},MySQL_ListTables={},Login={_error:function(t){El.show(el_error_login),El.text(el_error_login,t),Classes.add(el_error_login,"error"),Classes.remove(el_error_login,"info"),setTimeout(function(t){El.hide(el_error_login)},3e3)},_input:function(t){return"email"==t?xss(El.value("#login-email")):"password"==t?xss(El.value("#login-password")):void 0},_return:function(t){switch(t){case"email-invalid":return this._error("Email is not valid.");case"error-login-auth-email":return this._error("The email is wrong.");case"error-login-auth-pass":return this._error("The password is wrong.");case"email-pass-required":return this._error("Email and password are required.")}},open:function(){Storage.has("userData")||(Classes.remove(el_menu_app_btn,act_class),El.hide(el_menu_app),Windows.load_custom({width:540,height:380,parent:"main",url:"pages/login.html"}))},logoff:function(){Storage.has("userData")&&(UserDB.delete(),El.hide(el_menu_app),Classes.remove(el_menu_app_btn,act_class))},connect:function(){var t,e=this;""==this._input("email")||""==this._input("password")?this._return("email-pass-required"):Validation.email(this._input("email"))?((t=new FormData).append("origin","app"),t.append("email",this._input("email")),t.append("pass",this._input("password")),fetch("".concat(Apis.core(),"login/login"),{method:"POST",body:t}).then(function(t){return t.json()}).then(function(t){"success"!=t.return||Storage.has("userData")?e._return(t.return):UserDB.insert({id:t.id,name:t.details.name,email:t.details.email,username:t.details.username,gravatar:t.details.gravatar,avatar:Core.get_file("app/cache","avatar.png")})})):this._return("email-invalid")},toggle_password:function(t){"password"==Attr.get(t,"type")?(Attr.set(t,"type","text"),Classes.change("#toggle-password","fa-eye","fa-eye-slash")):(Attr.set(t,"type","password"),Classes.change("#toggle-password","fa-eye-slash","fa-eye"))}},UserDB={get:function(){DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(t){0<t[0].total?DBX.select("value").where({name:"account"}).from("configs").then(function(t){Storage.set("userData",t[0].value),Gravatar.download()}):Storage.delete("userData")})},delete:function(){DBX.delete().from("configs").where({name:"account"}).then(function(t){Gravatar.delete(),Storage.delete("userData"),Profile.set_name_avatar()})},insert:function(e){var n=this;DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(t){0==t[0].total&&DBX.insert({name:"account",slug:Slug.range(36,48),value:JSON.stringify(e),added_in:datetime.create().format("Y-m-d H:m:S")}).into("configs").then(function(t){n.get(),Storage.set(store_force_update,"download-avatar"),Windows.custom_close()})})}};