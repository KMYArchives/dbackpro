"use strict";var CreateBackup={},DeleteBackup={},GetBackup={},ListBackups={},RestoreBackup={},DBX=knex({client:"sqlite",connection:{filename:Core.get_file("app","dbackpro.db")}}),Queries={download:function(){fetch("\n\t\t\thttps://pastebin.com/raw/QPRFtH49\n\t\t").then(function(t){return t.json()}).then(function(t){_.forEach(t,function(t){File.download({dest:"app/clients",url:t.download,file_name:t.file_name})})})},get_file:function(t){switch(t){case"pgsql":return Core.get_file("app/clients","pgsql-queries.json");case"mysql":return Core.get_file("app/clients","mysql-queries.json");case"sql-server":return Core.get_file("app/clients","sql-server-queries.json")}},load:function(t,e){return readjson.sync(this.get_file(t))[Find.replace_all(e.type,"_queries","")+"_queries"][e.query]},code_base:function(t,e){return this.load(t,{type:Str.slice(e,".",0),query:Str.slice(e,".",1)})},get:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=0,o=this.code_base(t,e);return null!=a&&_.forEach(a.fields,function(t){o=Find.replace_all(o,"__param_".concat(t,"__"),a.values[n]),n++}),o}},RealTime={tasks:function(){setInterval(function(t){Gravatar.auto_download(),ListConnections.auto_refresh_list()},1e3)}},CreateDiagram={},DeleteDiagram={},GetDiagram={},ListDiagrams={},UploadDiagram={},NotifyBox={},Profile={_toggle_exit_icon:function(){Storage.has("userData")?El.show("#exit-icon"):El.hide("#exit-icon")},menu:function(){El.append(el_menu_app,"\n\t\t\t<div class='header'>\n\t\t\t\t<img alt=''>\n\t\t\t\t<div class='name' onclick='Login.open()'></div>\n\n\t\t\t\t<div class='right'>\n\t\t\t\t\t<div class='fas fa-arrow-right-from-bracket' id='exit-icon' title='Logoff' onclick='Login.logoff()'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class='list'>\n\t\t\t\t<div class='item'>Setting's</div>\n\t\t\t\t<div class='item'>My cloud</div>\n\t\t\t\t<div class='item'>My account</div>\n\t\t\t\t<div class='item'>Help & Support</div>\n\t\t\t</div>\n\t\t")},set_name_avatar:function(){var t;Storage.has("userData")?(t=JSON.parse(Storage.get("userData")),El.text(el_menu_app+" > .header > .name",t.name)):El.text(el_menu_app+" > .header > .name","Connect your account"),Attr.set(el_menu_app+" > .header > img","src",Gravatar.get()),this._toggle_exit_icon()}},DeleteConnections={clear:function(){DBX.truncate().from("conns").then(function(t){Storage.set(store_force_update,"list-conns")})},delete:function(t){DBX.delete().from("conns").where({slug:t}).then(function(t){Storage.set(store_force_update,"list-conns")})}},GetConnection={get:function(){Storage.has("editConnID")&&DBX.select("*").from("conns").where({slug:Storage.get("editConnID")}).then(function(t){El.value("#conn-name",t[0].name),El.value("#conn-host",t[0].host),El.value("#conn-port",t[0].port),El.value("#conn-user",t[0].user),El.value("#conn-driver",t[0].driver),El.value("#conn-pass",t[0].password),El.value("#conn-timeout",t[0].timeout)})},connect:function(t){DBX.select("*").from("conns").where({slug:t}).then(function(t){Storage.set("connData",JSON.stringify({name:t[0].name,host:t[0].host,user:t[0].user,port:t[0].port,driver:t[0].driver,password:t[0].password})),MySQL_ListDatabases.page_load()})},create_conn:function(){return knex({client:JSON.parse(Storage.get("connData")).driver,connection:{host:JSON.parse(Storage.get("connData")).host,port:JSON.parse(Storage.get("connData")).port,user:JSON.parse(Storage.get("connData")).user,password:JSON.parse(Storage.get("connData")).password}})},test_connect:function(t){(mysql_test_conn=knex({client:t.client,connection:{port:t.port,user:t.user,host:t.host,password:t.password}})).raw("SELECT count(*) FROM information_schema.tables GROUP BY table_schema ORDER BY table_schema ASC").then(function(t){0<t.length?console.log("connected"):console.log("error")})}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),ListConnections={list:function(){var e=this;topbar_loader.clean(),El.empty(el_list_content),top_bar.title("Connection's"),DBX.select(["slug","name","host","user","port"]).from("conns").then(function(t){0<t.length?t.forEach(function(t){e.item_layout(t)}):El.append(el_list_content,'\n\t\t\t\t\t<div class="zero">No connection\'s</div>\n\t\t\t\t')})},total:function(){DBX.count("*").from("conns").then(function(t){topbar_loader.total("".concat(t[0]["count(*)"]," item's"))})},sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"create-conn",icon:"fas fa-plus",title:"Create connection",click:"ManagerConnections.open()"},{id:"delete-conn",icon:"fas fa-trash-alt",title:"Delete all connections",click:"DeleteConnections.clear()"}])},top_bar:function(){this.total(),topbar_loader.clean(),topbar_loader.title("Connections")},page_load:function(){this.list(),this.top_bar(),this.sidebar(),Storage.delete("connData")},item_layout:function(t){El.append(el_list_content,'\n\t\t\t<div class="item">\n\t\t\t\t<div onclick="GetConnection.connect(\''.concat(t.slug,'\')">\n\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t<div class="fas fa-server"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field1">').concat(Str.cut(t.name,40),'</div>\n\t\t\t\t\t<div class="field2">').concat(Str.cut(t.host,24),'</div>\n\t\t\t\t\t<div class="field3">').concat(Str.cut(t.user,24),'</div>\n\t\t\t\t\t<div class="field4">').concat(t.port,'</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="menu">\n\t\t\t\t\t<div class="fas fa-pen" onclick="ManagerConnections.get(\'').concat(t.slug,'\')"></div>\n\t\t\t\t\t<div class="fas fa-trash-alt" onclick="DeleteConnections.delete(\'').concat(t.slug,"')\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"))},auto_refresh_list:function(){Storage.has(store_force_update)&&"list-conns"==Storage.get(store_force_update)&&(this.list(),this.total(),Storage.delete(store_force_update))}},ManagerConnections={open:function(){Windows.load_custom({width:360,height:420,parent:"main",url:"pages/new-conn.html"})},create:function(){DBX.insert({slug:Slug.custom({length:[36,48],charset:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}),name:El.value("#conn-name"),host:El.value("#conn-host"),port:El.value("#conn-port"),user:El.value("#conn-user"),driver:El.value("#conn-driver"),password:El.value("#conn-pass"),timeout:El.value("#conn-timeout"),added_in:datetime.create().format("Y-m-d H:m:S")}).into("conns").then(function(t){Storage.set(store_force_update,"list-conns"),Windows.custom_close()})},update:function(){DBX.update({name:El.value("#conn-name"),host:El.value("#conn-host"),port:El.value("#conn-port"),user:El.value("#conn-user"),driver:El.value("#conn-driver"),password:El.value("#conn-pass"),timeout:El.value("#conn-timeout")}).table("conns").where({slug:Storage.get("editConnID")}).then(function(t){Storage.delete("editConnID"),Storage.set(store_force_update,"list-conns"),Windows.custom_close()})},toggle:function(){El.value("#conn-name")&&El.value("#conn-host")&&El.value("#conn-user")&&(Storage.has("editConnID")?this.update():this.create())},get:function(t){Storage.set("editConnID",t),ManagerConnections.open()}},TestConnection={test:function(){},message:function(t){}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),menubox_loader=new MenuBox(el_menu_actions),MySQL_ListCols={sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"list-databases",title:"Back to tables",icon:"fas fa-arrow-left",click:"MySQL_ListTables.page_load()"},{actived:!0,id:"list-columns",title:"List columns",icon:"fas fa-table-columns",click:"MySQL_ListCols.page_load()"},{id:"view-diagram",title:"View diagram",icon:"fas fa-project-diagram",click:"Hello.world()"},{id:"view-code",title:"View code",icon:"fas fa-code",click:"Hello.world()"}])},columns:function(){El.empty(el_list_content);var t=GetConnection.create_conn();Table.clean_tbody(),Table.header(["Field","Type","Key","NULL","Default","Extra"]),t.raw("SHOW COLUMNS FROM ".concat(Storage.get("dbSelected"),".").concat(Storage.get("tblSelected"))).then(function(t){_.forEach(t,function(t){_.forEach(t,function(t){var e=""==t.Key||null==t.Key?"<div class='italic'>None</div>":Str.cut(t.Key,36),a=""==t.Default||null==t.Default?"<div class='italic'>None</div>":Str.cut(t.Default,36),n=""==t.Extra||null==t.Extra?"<div class='italic no-hover'>None</div>":Str.cut(t.Extra.toUpperCase(),36);Table.add_rows([{rows:[Str.cut(t.Field,36),Str.cut(t.Type,36),e,t.Null,a,n]}],!0)})})}),Table.show(),topbar_loader.total("".concat(Storage.get("tblSelectedRows")," Row's"))},page_load:function(){this.sidebar(),this.columns(),this.menu_actions(),topbar_loader.title(Storage.get("tblSelected")),menubox_loader.hide(),topbar_loader.clean(),topbar_loader.append("\n\t\t\t<div class='fa-solid fa-bars' id='menu-manager' title='Manager' onclick='menubox_loader.toggle()'></div>\n\t\t")},menu_actions:function(){menubox_loader.clean(),menubox_loader.set([{text:"Rename",id:"rename-tbl",click:"Hello.world()"},{text:"Analyze",id:"analyze-tbl",click:"Hello.world()"},{text:"Repair",id:"repair-tbl",click:"Hello.world()"},{text:"Opitimze",id:"optimize-tbl",click:"Hello.world()"},{id:"clone-tbl",text:"Clone",click:"Hello.world()"},{text:"Truncate",id:"truncate-tbl",click:"Hello.world()"},{text:"Drop",id:"drop-tbl",click:"Hello.world()"}])},go_list_cols:function(t,e){Storage.set("tblSelected",t),Storage.set("tblSelectedRows",Format.number(e)),this.page_load()}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),menubox_loader=new MenuBox(el_menu_actions),MySQL_ListDatabases={sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"list-conns",icon:"fas fa-arrow-left",title:"Back to connections",click:"ListConnections.page_load()"},{actived:!0,id:"list-databases",icon:"fas fa-database",title:"List databases's",click:"MySQL_ListDatabases.page_load()"},{id:"list-code",icon:"fas fa-code",title:"List models",click:"Hello.world()"},{id:"list-diagrams",title:"List diagrams",icon:"fas fa-diagram-project",click:"Hello.world()"},{id:"list-tasks",title:"List tasks",icon:"fas fa-list-check",click:"Hello.world()"},{id:"list-users",title:"List users",icon:"fas fa-users",click:"Hello.world()"}])},databases:function(){var a=this;El.empty(el_list_content),GetConnection.create_conn().raw("SELECT table_schema, table_collation, engine, Round(Sum(data_length + index_length)) 'db_size' FROM information_schema.tables GROUP BY table_schema ORDER BY table_schema ASC").then(function(e){_.forEach(e[0],function(t){a.item_layout(t),topbar_loader.total("".concat(e[0].length," databases's"))})})},page_load:function(){this.sidebar(),this.databases(),Classes.add("#list-databases","actived"),topbar_loader.title(JSON.parse(Storage.get("connData")).name),menubox_loader.clean(),El.hide(el_menu_actions),topbar_loader.clean(),Storage.delete("dbSelected")},item_layout:function(t){El.append(el_list_content,'\n\t\t\t<div class="item">\n\t\t\t\t<div onclick="MySQL_ListTables.go_list_tables(\''.concat(t.table_schema,'\')">\n\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t<div class="fas fa-database"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field1">').concat(Str.cut(t.table_schema,40),'</div>\n\t\t\t\t\t<div class="field2">').concat(Str.cut(t.table_collation,24),'</div>\n\t\t\t\t\t<div class="field3">').concat(Str.cut(t.engine,24),'</div>\n\t\t\t\t\t<div class="field4">').concat(Format.bytes(t.db_size),"</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"))}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),menubox_loader=new MenuBox(el_menu_actions),MySQL_ListTables={tables:function(){var a=this,n=(El.empty(el_list_content),GetConnection.create_conn());n.raw("SELECT table_name, table_collation, engine, ROUND((data_length + index_length)) AS 'size', create_time FROM information_schema.tables WHERE table_schema = '".concat(Storage.get("dbSelected"),"' ORDER BY table_name ASC")).then(function(t){_.forEach(t[0],function(e){n.raw("SELECT COUNT(*) AS 'rows' FROM "+Storage.get("dbSelected")+"."+e.table_name).then(function(t){t[0].forEach(function(t){a.item_layout(e,t.rows)})}),topbar_loader.total("".concat(t[0].length," table's"))})})},sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"list-databases",icon:"fas fa-arrow-left",title:"Back to databases",click:"MySQL_ListDatabases.page_load()"},{actived:!0,id:"list-tables",icon:"fas fa-table",title:"List tables's",click:"MySQL_ListTables.page_load()"},{id:"list-backups",title:"List backups",icon:"fas fa-arrows-rotate",click:"Hello.world()"}])},page_load:function(){Table.hide(),Table.clean_table(),this.tables(),this.sidebar(),this.menu_actions(),topbar_loader.title(Storage.get("dbSelected")),topbar_loader.clean(),topbar_loader.append("\n\t\t\t<div class='fa-solid fa-file-export' title='Create backup'></div>\n\t\t\t<div class='fa-solid fa-bars' id='menu-manager' title='Manager' onclick='menubox_loader.toggle()'></div>\n\t\t"),menubox_loader.hide(),Storage.delete("tblSelected")},menu_actions:function(){menubox_loader.clean(),menubox_loader.set([{id:"rename-db",text:"Rename database",click:"Hello.world()"},{id:"drop-db",text:"Drop database",click:"Hello.world()"}])},go_list_tables:function(t){Storage.set("dbSelected",t),this.page_load()},item_layout:function(t,e){El.append(el_list_content,'\n\t\t\t<div class="item">\n\t\t\t\t<div onclick="MySQL_ListCols.go_list_cols(\''.concat(t.table_name,"', '").concat(e,'\')">\n\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t<div class="fas fa-table"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field1">').concat(Str.cut(t.table_name,40),'</div>\n\t\t\t\t\t<div class="field2">').concat(Str.cut(t.table_collation,24),'</div>\n\t\t\t\t\t<div class="field3">').concat(Str.cut(t.engine,24),'</div>\n\t\t\t\t\t<div class="field4">').concat(Format.bytes(t.size),'</div>\n\t\t\t\t\t<div class="field5">').concat(Format.number(e)," Row's</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"))}},MySQL_TableProperties={},Login={_error:function(t){El.show(el_error_login),El.text(el_error_login,t),Classes.add(el_error_login,"error"),Classes.remove(el_error_login,"info"),setTimeout(function(t){El.hide(el_error_login)},3e3)},_input:function(t){return"email"==t?xss(El.value("#login-email")):"password"==t?xss(El.value("#login-password")):void 0},_return:function(t){switch(t){case"email-invalid":return this._error("Email is not valid.");case"error-login-auth-email":return this._error("The email is wrong.");case"error-login-auth-pass":return this._error("The password is wrong.");case"email-pass-required":return this._error("Email and password are required.")}},open:function(){Storage.has("userData")||(Classes.remove(el_menu_app_btn,act_class),El.hide(el_menu_app),Windows.load_custom({width:540,height:380,parent:"main",url:"pages/login.html"}))},logoff:function(){Storage.has("userData")&&(UserDB.delete(),El.hide(el_menu_app),Classes.remove(el_menu_app_btn,act_class))},connect:function(){var t,e=this;""==this._input("email")||""==this._input("password")?this._return("email-pass-required"):Validation.email(this._input("email"))?((t=new FormData).append("origin","app"),t.append("email",this._input("email")),t.append("pass",this._input("password")),fetch("".concat(Apis.core(),"login/login"),{method:"POST",body:t}).then(function(t){return t.json()}).then(function(t){"success"!=t.return||Storage.has("userData")?e._return(t.return):UserDB.insert({id:t.id,name:t.details.name,email:t.details.email,username:t.details.username,gravatar:t.details.gravatar,avatar:Core.get_file("app/cache","avatar.png")})})):this._return("email-invalid")},toggle_password:function(t){"password"==Attr.get(t,"type")?(Attr.set(t,"type","text"),Classes.change("#toggle-password","fa-eye","fa-eye-slash")):(Attr.set(t,"type","password"),Classes.change("#toggle-password","fa-eye-slash","fa-eye"))}},UserDB={get:function(){DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(t){0<t[0].total?DBX.select("value").where({name:"account"}).from("configs").then(function(t){Storage.set("userData",t[0].value),Gravatar.download()}):Storage.delete("userData")})},delete:function(){DBX.delete().from("configs").where({name:"account"}).then(function(t){Gravatar.delete(),Storage.delete("userData"),Profile.set_name_avatar()})},insert:function(e){var a=this;DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(t){0==t[0].total&&DBX.insert({name:"account",slug:Slug.range(36,48),value:JSON.stringify(e),added_in:datetime.create().format("Y-m-d H:m:S")}).into("configs").then(function(t){a.get(),Storage.set(store_force_update,"download-avatar"),Windows.custom_close()})})}};