"use strict";var Cache={},DBX=knex({client:"sqlite3",connection:{filename:Core.get_file("app","dbackpro.db")}}),Queries={download:function(){fetch("\n\t\t\thttps://pastebin.com/raw/QPRFtH49\n\t\t").then(function(e){return e.json()}).then(function(e){_.forEach(e,function(e){File.download({dest:"app/clients",url:e.download,file_name:e.file_name})})})},get_file:function(e){switch(e){case"pgsql":return Core.get_file("app/clients","pgsql-queries.json");case"mysql":return Core.get_file("app/clients","mysql-queries.json");case"sql-server":return Core.get_file("app/clients","sql-server-queries.json")}},load:function(e,t){return readjson.sync(this.get_file(e))[Find.replace_all(t.type,"_queries","")+"_queries"][t.query]},code_base:function(e,t){return this.load(e,{type:Str.slice(t,".",0),query:Str.slice(t,".",1)})},get:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=0,o=this.code_base(e,t);return null!=n&&_.forEach(n.fields,function(e){o=Find.replace_all(o,"__param_".concat(e,"__"),n.values[a]),a++}),o}},Profile={_toggle_exit_icon:function(){Storage.has("userData")?El.show("#exit-icon"):El.hide("#exit-icon")},menu:function(){El.append(el_menu_app,"\n\t\t\t<div class='header'>\n\t\t\t\t<img alt=''>\n\t\t\t\t<div class='name' onclick='Login.open()'></div>\n\n\t\t\t\t<div class='right'>\n\t\t\t\t\t<div class='fas fa-arrow-right-from-bracket' id='exit-icon' title='Logoff' onclick='Login.logoff()'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class='list'>\n\t\t\t\t<div class='item'>Setting's</div>\n\t\t\t\t<div class='item'>My cloud</div>\n\t\t\t\t<div class='item'>My account</div>\n\t\t\t\t<div class='item'>Help & Support</div>\n\t\t\t</div>\n\t\t")},set_name_avatar:function(){var e;Storage.has("userData")?(e=JSON.parse(Storage.get("userData")),El.text(el_menu_app+" > .header > .name",e.name)):El.text(el_menu_app+" > .header > .name","Connect your account"),Attr.set(el_menu_app+" > .header > img","src",Gravatar.get()),this._toggle_exit_icon()}},CreateConnections={},DeleteConnections={},EditConnections={},GetConnection={get:function(e){},connect:function(e){mysql_conn=knex({client:"mysql",connection:{port:3306,user:"root",password:null,host:"localhost"},debug:!0}),mysql_conn_status=mysql_conn?"connected":"error-connected"},test_connect:function(e){return!!(mysql_test_conn=knex({client:e.client,connection:{port:e.port,user:e.user,host:e.host,timeout:e.timeout,password:e.password},debug:!0}))}},topbar_loader=new TopBar(el_topbar),sidebar_loader=new SideBar(el_sidebar),ListConnections={list:function(){Table.clean_table(),Table.header(["Name","Host","User","Added in"]),DBX.select(["slug","name","host","user","added_in"]).from("conns").then(function(e){e.forEach(function(e){Table.add_rows([{slug:e.slug,click:"Hello.world()",rows:[e.name,e.host,e.user,e.added_in]}],!0)})})},total:function(){DBX.count("*").from("conns").then(function(e){topbar_loader.total("".concat(e[0]["count(*)"]," item's"))})},sidebar:function(){sidebar_loader.clean(),sidebar_loader.set([{id:"create-conn",icon:"fas fa-plus",title:"Create connection",click:"Hello.world()"},{id:"delete-conn",icon:"fas fa-trash-alt",title:"Delete all connections",click:"Hello.world()"}])},top_bar:function(){this.total(),topbar_loader.clean(),topbar_loader.title("Connections")},page_load:function(){this.list(),this.top_bar(),this.sidebar()}},ModalsConnections={},MySQL_ListDatabases={},Login={_error:function(e){El.show(el_error_login),El.text(el_error_login,e),Classes.add(el_error_login,"error"),Classes.remove(el_error_login,"info"),setTimeout(function(e){El.hide(el_error_login)},3e3)},_input:function(e){return"email"==e?xss(El.value("#login-email")):"password"==e?xss(El.value("#login-password")):void 0},_return:function(e){switch(e){case"email-invalid":return this._error("Email is not valid.");case"error-login-auth-email":return this._error("The email is wrong.");case"error-login-auth-pass":return this._error("The password is wrong.");case"email-pass-required":return this._error("Email and password are required.")}},open:function(){Storage.has("userData")||(Classes.remove(el_menu_app_btn,act_class),El.hide(el_menu_app),Windows.login_open())},logoff:function(){Storage.has("userData")&&(UserDB.delete(),El.hide(el_menu_app),Classes.remove(el_menu_app_btn,act_class))},connect:function(){var e,t=this;""==this._input("email")||""==this._input("password")?this._return("email-pass-required"):Validation.email(this._input("email"))?((e=new FormData).append("origin","app"),e.append("email",this._input("email")),e.append("pass",this._input("password")),fetch("".concat(Apis.core(),"login/login"),{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){"success"!=e.return||Storage.has("userData")?t._return(e.return):UserDB.insert({id:e.id,name:e.details.name,email:e.details.email,username:e.details.username,gravatar:e.details.gravatar,avatar:Core.get_file("app/cache","avatar.png")})})):this._return("email-invalid")},toggle_password:function(e){"password"==Attr.get(e,"type")?(Attr.set(e,"type","text"),Classes.change("#toggle-password","fa-eye","fa-eye-slash")):(Attr.set(e,"type","password"),Classes.change("#toggle-password","fa-eye-slash","fa-eye"))}},UserDB={get:function(){DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(e){0<e[0].total?DBX.select("value").where({name:"account"}).from("configs").then(function(e){Storage.set("userData",e[0].value),Gravatar.download()}):Storage.delete("userData")})},delete:function(){DBX.delete().from("configs").where({name:"account"}).then(function(e){Gravatar.delete(),Storage.delete("userData"),Profile.set_name_avatar()})},insert:function(t){var n=this;DBX.select(DBX.raw("COUNT(*) AS total")).where({name:"account"}).from("configs").then(function(e){0==e[0].total&&DBX.insert({name:"account",slug:Slug.range(36,48),value:JSON.stringify(t),added_in:datetime.create().format("Y-m-d H:m:S")}).into("configs").then(function(e){n.get(),Windows.login_close()})})}};