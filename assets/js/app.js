"use strict";window.$=window.jQuery=require("jquery");var mysql_conn,mysql_test_conn,mysql_conn_status,psql_conn,psql_test_conn,psql_conn_status,os=require("os"),_=require("lodash"),open=require("open"),knex=require("knex"),path=require("path"),hasha=require("hasha"),fs=require("fs-extra"),mysql=require("mysql"),imgur=require("imgur"),crypt=require("crypto"),sqlite3=require("sqlite3"),node_cron=require("node-cron"),si=require("systeminformation"),datetime=require("node-datetime"),html2canvas=require("html2canvas"),_require=require("electron"),electron=_require.electron,ipcRenderer=_require.ipcRenderer,remote=_require.remote,DB=knex({client:"sqlite3",connection:{filename:"dbackpro.db"}}),el_sidebar="#left-sidebar > .menu",el_topbar="#top-bar",Classes={has:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:act_class;return!$(e).parent().find(e).hasClass(t)},replace:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:act_class;$(t).addClass(n),e.forEach(function(e){$(e).removeClass(n)})},toggle:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:act_class,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e;(n=$(e).parent().find(n)).hasClass(t)?n.removeClass(t):n.addClass(t)},is_visible:function(e){return $(e).is(":visible")}},GUI={toggle_boxes:function(e){Classes.toggle(e,act_class),$("#"+$(e).attr("toggle")).fadeToggle(anim_time),null!=$(e).attr("hide")&&$(e).attr("hide").split(",").forEach(function(e){$("#"+e.replace(/\s/g,"")).hide()}),null!=$(e).attr("rem-act")&&$(e).attr("rem-act").split(",").forEach(function(e){$("."+e.replace(/\s/g,"")).removeClass(act_class)})},empty_multiple:function(e){e.forEach(function(e){$(e).empty()})},message:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2500,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:anim_time;t=Find.replace_all(t,"#",""),$("#"+t).empty(),$("#"+t).text(e),$("#"+t).fadeIn(a),setTimeout(function(e){$("#"+t).fadeOut(a)},n)}},Modals={show:function(e){$(mask).fadeIn(),$(e).fadeIn(),$(menu_user).fadeOut(),$("header > nav > .fa-bars").removeClass(act_class)},close_all:function(){Classes.is_visible(modal)&&($(mask).fadeOut(),$(modal).fadeOut())},close_all_esc:function(){var t=this;document.addEventListener("keydown",function(e){"Escape"===e.key&&t.close_all()})}},Copy={input:function(e){$(e).select(),document.execCommand("copy")},content:function(e){var t=document.createElement("input");return document.body.appendChild(t),t.setAttribute("value",e),t.select(),1==document.execCommand("copy")?(document.body.removeChild(t),!0):(document.body.removeChild(t),!1)}},Random={slug:function(e){for(var t="",n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a=0,r=n.length;a<e;++a)t+=n.charAt(Math.floor(Math.random()*r));return t},password:function(e){for(var t="",n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@?!#$%&*^~<>(){}[]-_+=",a=0,r=n.length;a<e;++a)t+=n.charAt(Math.floor(Math.random()*r));return t},password_b64:function(e){return Base64.bota(this.password(e))}},ConfirmMisc={text:function(e){switch(e){case"drop_table":return"This action cannot be undone. Confirm drop table ?";case"delete_task":case"delete_backup":case"delete_snippet":case"delete_diagram":return"This action cannot be undone. Confirm deletion ?";case"rename_table":return"Rename table";case"show_conns":return"Back to homepage ?";case"logoff":return"Are you sure you want to sign out of your account ?";case"delete_conn":return"Are you sure you want to delete this connection and everything that is linked to it ?";case"truncate_table":return"This action cannot be undone. Confirm truncate table ?";case"delete_collection":return"This action cannot be undone. Confirm delete collection ?";case"move_trash_diagram":case"move_trash_snippet":return"Are you sure you want to move that for trash ?"}},placeholder:function(e){switch(e){case"drop_table":case"truncate_table":return"Type the table name for execute the action";case"rename_table":return"Type the new name of table"}}},ConfirmTask={close_modal:function(){$(mask).fadeOut(),$(confirm_mdl).fadeOut()},close:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;switch(this.close_modal(),e){case"move_trash_diagram":GetDiagram.get_local();break;case"move_trash_snippet":GetSnippet.get_local()}},action:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(""!=$("#confirm-input").val())if($("#confirm-input").val()==Storage.get("table"))switch(e){case"drop_table":MySqlTableQueries.drop();break;case"truncate_table":MySqlTableQueries.truncate()}else GUI.message("error-confirm","Error: the table name is incorrect",2500);else GUI.message("error-confirm","Error: type the table name for execute the action",2500)},run:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;switch(e){case"drop_table":case"truncate_table":this.action(e);break;case"show_conns":StartPage.back();break;case"logoff":Login.logoff();break;case"delete_conn":GetConn.delete(t);break;case"delete_snippet":SnippetIO.delete(t);break;case"delete_diagram":DiagramIO.delete(t);break;case"delete_collection":CollectionManager.delete(t);break;case"move_trash_diagram":TrashActions.move("diagrams",t);break;case"move_trash_snippet":TrashActions.move("snippets",t)}Find.in_array(e,["drop_table","truncate_table"])||this.close()}},Confirm={hide_all_box:function(){$(menu_user).hide(),$(trash_box).hide(),$(share_box).hide(),$(conns_list).hide(),$(menu_action).hide(),$(history_box).hide(),$(contacts_box).hide(),$(collections_box).hide()},run:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;Modals.close_all(),this.hide_all_box(),$(menu_btn).removeClass(act_class),$(show_conns).removeClass(act_class),$(menu_sidebar+" > div").removeClass(act_class),$(menu_manager+" > .icon").removeClass(act_class),$(confirm_mdl).empty(),$(confirm_mdl).append("\n\t\t\t<div class='conf-content'>\n\t\t\t\t<div class='label'>".concat(ConfirmMisc.text(e),"</div>\n\t\t\t\t<input type='text' id='confirm-input' placeholder='").concat(ConfirmMisc.placeholder(e),"'>\n\t\t\t\t<div class='error' id='error-confirm'></div>\n\t\t\t</div>\n\n\t\t\t<div class='conf-footer'>\n\t\t\t\t<div class='btn' onclick=\"ConfirmTask.run('").concat(e,"', '").concat(t,"')\">Confirm</div>\n\t\t\t\t<div class='btn' onclick=\"ConfirmTask.close('").concat(e,"')\">Cancel</div>\n\t\t\t</div>\n\t\t")),$(mask).fadeIn(),$(confirm_mdl).fadeIn(),Find.in_array(e,["drop_table","rename_table","truncate_table"])&&$("#confirm-input").show()}},Find={search:function(e,t){return-1!=e.search(t)},in_array:function(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},array_remove_item:function(e,t){return-1<(t=e.indexOf(t))&&e.splice(t,1),e},replace_all:function(e,t,n){return e.replace(new RegExp(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),n)},replace_multiple:function(e,t,n){for(var a=0;a<t.length;a++)e=e.replace(new RegExp(t[a],"g"),n[a]);return e},replace:function(e,t,n){return e.replace(t,n)}},Format={base64:function(e){return e.replace("data:","").replace("image/png","").replace("image/jpeg","").replace("image/gif","").replace("image/webp","").replace("base64,","")},int_float:function(e){for(var t=0,n="",a=e.toString(),r=a.length;0<r;r--)n+=a.substr(r-1,1)+(2==t&&1!=r?".":""),t=2==t?0:t+1;return n.split("").reverse().join("")},bytes:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;if(0===(e=parseInt(e)))return"0 Bytes";var n=t<0?0:t,t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},date_time:function(e,t){var n=null==(n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)?{day:"2-digit",year:"numeric",hour:"2-digit",month:"numeric",minute:"2-digit",second:"2-digit"}:{day:n.day,year:n.year,hour:n.hour,month:n.month,minute:n.minute,second:n.second};return new Date(e).toLocaleDateString(t,n)},percent:function(e,t){var n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2;return 0<(n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100)*e/t?(n*e/t).toFixed(a):0},float:function(e,t){return parseFloat(e).toPrecision(t)}},Str={capitalize:function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},cut:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"...";return e.length>t?e.slice(0,t-n.length)+n:e},parse:function(e){return JSON.parse(e)},slice:function(e,t,n){return e.split(t)[n]},percent:function(e,t){return(e*(2<arguments.length&&void 0!==arguments[2]?arguments[2]:100)/t).toFixed(3<arguments.length&&void 0!==arguments[3]?arguments[3]:1)},get_last_param:function(e){return e.split("/").slice(-1)[0]},remove_protocols:function(e){return Find.replace(e,/(^\w+:|^)\/\//,"")},stringify:function(e){return JSON.stringify(e,null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:4)}},Validation={ip:function(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)},ip_v6:function(e){return/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/.test(e)},email:function(e){return/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test(e)},int:function(e){return/^\d+$/.test(e)},bool:function(e){return/^\w+$/.test(e)},not_empty:function(e){return/\S+/.test(e)},float:function(e){return/\-?\d+\.\d+/g.test(e)},hash:function(e){return/^[a-f0-9]{128}/gm.test(e)},url:function(e){return/^(http|https):\/\/[^ "]+$/.test(e)},base64:function(e){return/^[-A-Za-z0-9+=]{1,50}|=[^=]|={3,}$/.test(e)},phone:function(e){return/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/.test(e)},date:function(e){return/([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))/.test(e)}};