!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}(function(i){"use strict";var s="CodeMirror-activeline",c="CodeMirror-activeline-background",a="CodeMirror-activeline-gutter";function u(e){for(var t=0;t<e.state.activeLines.length;t++)e.removeLineClass(e.state.activeLines[t],"wrap",s),e.removeLineClass(e.state.activeLines[t],"background",c),e.removeLineClass(e.state.activeLines[t],"gutter",a)}function r(t,e){for(var o=[],n=0;n<e.length;n++){var i,r=e[n],l=t.getOption("styleActiveLine");("object"==typeof l&&l.nonEmpty?r.anchor.line==r.head.line:r.empty())&&(i=t.getLineHandleVisualStart(r.head.line),o[o.length-1]!=i&&o.push(i))}!function(e,t){if(e.length==t.length){for(var o=0;o<e.length;o++)if(e[o]!=t[o])return;return 1}}(t.state.activeLines,o)&&t.operation(function(){u(t);for(var e=0;e<o.length;e++)t.addLineClass(o[e],"wrap",s),t.addLineClass(o[e],"background",c),t.addLineClass(o[e],"gutter",a);t.state.activeLines=o})}function l(e,t){r(e,t.ranges)}i.defineOption("styleActiveLine",!1,function(e,t,o){var n=o!=i.Init&&o;t!=n&&(n&&(e.off("beforeSelectionChange",l),u(e),delete e.state.activeLines),t&&(e.state.activeLines=[],r(e,e.listSelections()),e.on("beforeSelectionChange",l)))})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}(function(i){"use strict";function r(e){e.state.markedSelection&&e.operation(function(){!function(e){if(!e.somethingSelected())return c(e);if(1<e.listSelections().length)return a(e);var t=e.getCursor("start"),o=e.getCursor("end"),n=e.state.markedSelection;if(!n.length)return s(e,t,o);var i=n[0].find(),r=n[n.length-1].find();if(!i||!r||o.line-t.line<=d||0<=v(t,r.to)||v(o,i.from)<=0)return a(e);for(;0<v(t,i.from);)n.shift().clear(),i=n[0].find();v(t,i.from)<0&&(i.to.line-t.line<d?(n.shift().clear(),s(e,t,i.to,0)):s(e,t,i.from,0));for(;v(o,r.to)<0;)n.pop().clear(),r=n[n.length-1].find();0<v(o,r.to)&&(o.line-r.from.line<d?(n.pop().clear(),s(e,r.from,o)):s(e,r.to,o))}(e)})}function l(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){c(e)})}i.defineOption("styleSelectedText",!1,function(e,t,o){var n=o&&o!=i.Init;t&&!n?(e.state.markedSelection=[],e.state.markedSelectionStyle="string"==typeof t?t:"CodeMirror-selectedtext",a(e),e.on("cursorActivity",r),e.on("change",l)):!t&&n&&(e.off("cursorActivity",r),e.off("change",l),c(e),e.state.markedSelection=e.state.markedSelectionStyle=null)});var d=8,m=i.Pos,v=i.cmpPos;function s(e,t,o,n){if(0!=v(t,o))for(var i=e.state.markedSelection,r=e.state.markedSelectionStyle,l=t.line;;){var s=l==t.line?t:m(l,0),c=l+d,a=c>=o.line,u=a?o:m(c,0),f=e.markText(s,u,{className:r});if(null==n?i.push(f):i.splice(n++,0,f),a)break;l=c}}function c(e){for(var t=e.state.markedSelection,o=0;o<t.length;++o)t[o].clear();t.length=0}function a(e){c(e);for(var t=e.listSelections(),o=0;o<t.length;o++)s(e,t[o].from(),t[o].to())}}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}(function(n){"use strict";function i(e){e.state.selectionPointer.rects=null,r(e)}function r(e){e.state.selectionPointer.willUpdate||(e.state.selectionPointer.willUpdate=!0,setTimeout(function(){!function(e){var t=e.state.selectionPointer;if(!t)return;if(null==t.rects&&null!=t.mouseX&&(t.rects=[],e.somethingSelected()))for(var o=e.display.selectionDiv.firstChild;o;o=o.nextSibling)t.rects.push(o.getBoundingClientRect());var n=!1;if(null!=t.mouseX)for(var i=0;i<t.rects.length;i++){var r=t.rects[i];r.left<=t.mouseX&&r.right>=t.mouseX&&r.top<=t.mouseY&&r.bottom>=t.mouseY&&(n=!0)}var l=n?t.value:"";e.display.lineDiv.style.cursor!=l&&(e.display.lineDiv.style.cursor=l)}(e),e.state.selectionPointer.willUpdate=!1},50))}n.defineOption("selectionPointer",!1,function(t,e){var o=t.state.selectionPointer;o&&(n.off(t.getWrapperElement(),"mousemove",o.mousemove),n.off(t.getWrapperElement(),"mouseout",o.mouseout),n.off(window,"scroll",o.windowScroll),t.off("cursorActivity",i),t.off("scroll",i),t.state.selectionPointer=null,t.display.lineDiv.style.cursor=""),e&&(o=t.state.selectionPointer={value:"string"==typeof e?e:"default",mousemove:function(e){!function(e,t){var o=e.state.selectionPointer;(null==t.buttons?t.which:t.buttons)?o.mouseX=o.mouseY=null:(o.mouseX=t.clientX,o.mouseY=t.clientY);r(e)}(t,e)},mouseout:function(e){!function(e,t){{var o;e.getWrapperElement().contains(t.relatedTarget)||((o=e.state.selectionPointer).mouseX=o.mouseY=null,r(e))}}(t,e)},windowScroll:function(){i(t)},rects:null,mouseX:null,mouseY:null,willUpdate:!1},n.on(t.getWrapperElement(),"mousemove",o.mousemove),n.on(t.getWrapperElement(),"mouseout",o.mouseout),n.on(window,"scroll",o.windowScroll),t.on("cursorActivity",i),t.on("scroll",i))})});